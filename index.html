<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SS Printers - Place Your Order</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 300px; padding: 5px; margin-top: 5px; }
    #submitBtn { margin-top: 15px; padding: 8px 15px; }
    #orderResult { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>

<h2>SS Printers - Place Your Order</h2>

<form id="orderForm">
  <label>Client / Company:
    <input type="text" id="clientName" required>
  </label>

  <label>Product Type:
    <input type="text" id="productType" required>
  </label>

  <label>Quantity:
    <input type="number" id="quantity" required>
  </label>

  <label>Material Type:
    <input type="text" id="materialType">
  </label>

  <label>Material Cost:
    <input type="number" step="0.01" id="materialCost">
  </label>

  <label>Production Cost:
    <input type="number" step="0.01" id="productionCost">
  </label>

  <label>GST %:
    <input type="number" step="0.01" id="gstPercent">
  </label>

  <label>Delivery Date:
    <input type="date" id="deliveryDate" required>
  </label>

  <label>Mobile:
    <input type="text" id="mobile">
  </label>

  <label>Email:
    <input type="email" id="email" required>
  </label>

  <label>Notes:
    <textarea id="notes"></textarea>
  </label>

  <label>Design File (optional):
    <input type="file" id="designFile" accept=".png,.jpg,.jpeg,.pdf">
  </label>

  <button type="submit" id="submitBtn">Submit Order</button>
</form>

<div id="orderResult"></div>

<!-- Firebase JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDPhLu10o_ce_1PW-_sP0MZGN8o_bMfZtk",
    authDomain: "ss-printers.firebaseapp.com",
    projectId: "ss-printers",
    storageBucket: "ss-printers.firebasestorage.app",
    messagingSenderId: "625571268370",
    appId: "1:625571268370:web:221090a300511c1ff4d5cb"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const orderForm = document.getElementById("orderForm");
  const resultDiv = document.getElementById("orderResult");

  orderForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    resultDiv.innerText = "";

    const clientName = document.getElementById("clientName").value.trim();
    const productType = document.getElementById("productType").value.trim();
    const quantity = parseInt(document.getElementById("quantity").value) || 0;
    const materialType = document.getElementById("materialType").value.trim();
    const materialCost = parseFloat(document.getElementById("materialCost").value) || 0;
    const productionCost = parseFloat(document.getElementById("productionCost").value) || 0;
    const gstPercent = parseFloat(document.getElementById("gstPercent").value) || 0;
    const deliveryDate = document.getElementById("deliveryDate").value;
    const mobile = document.getElementById("mobile").value.trim();
    const email = document.getElementById("email").value.trim();
    const notes = document.getElementById("notes").value.trim();
    const fileInput = document.getElementById("designFile");

    // Validation
    if (!clientName || !productType || quantity <= 0 || !deliveryDate || !email) {
      resultDiv.innerText = "❌ Please fill all required fields correctly.";
      return;
    }

    // Upload file if exists
    let fileURL = "";
    if (fileInput && fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const storageRef = ref(storage, `orders/${Date.now()}_${file.name}`);
      try {
        const snapshot = await uploadBytes(storageRef, file);
        fileURL = await getDownloadURL(snapshot.ref);
      } catch (err) {
        console.error("File upload error:", err);
        resultDiv.innerText = "❌ Error uploading file: " + err.message;
        return;
      }
    }

    const orderData = {
      clientName,
      productType,
      quantity,
      materialType,
      materialCost,
      productionCost,
      gstPercent,
      deliveryDate,
      mobile,
      email,
      notes,
      fileURL,
      timestamp: serverTimestamp()
    };

    try {
      await addDoc(collection(db, "orders"), orderData);
      resultDiv.innerText = "✅ Order submitted successfully!";
      orderForm.reset();
    } catch (error) {
      console.error("Firestore submission error:", error);
      resultDiv.innerText = "❌ Error submitting order: " + error.message;
    }
  });
</script>

</body>
</html>

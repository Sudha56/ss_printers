<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SS Printers - Place Your Order</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 300px; padding: 5px; margin-top: 5px; }
    #submitBtn { margin-top: 15px; padding: 8px 15px; }
    #orderResult { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>

<h2>SS Printers - Place Your Order</h2>

<form id="orderForm">
  <label>Client / Company:
    <input type="text" id="clientName" required>
  </label>

  <label>Product Type:
    <select id="productType" required>
      <option value="">Select Product Type</option>
      <option value="Brochure">Brochure</option>
      <option value="Flyer">Flyer</option>
      <option value="Business Card">Business Card</option>
      <option value="Poster">Poster</option>
      <option value="Banner">Banner</option>
      <option value="Letterhead">Letterhead</option>
      <option value="Invitation Card">Invitation Card</option>
      <option value="Sticker">Sticker</option>
      <option value="Booklet / Catalog">Booklet / Catalog</option>
      <option value="Envelope">Envelope</option>
      <option value="Menu Card">Menu Card</option>
      <option value="Calendar">Calendar</option>
    </select>
  </label>

  <label>Quantity:
    <input type="number" id="quantity" required>
  </label>

  <label>Delivery Date:
    <input type="date" id="deliveryDate" required>
  </label>

  <label>Mobile:
    <input type="text" id="mobile">
  </label>

  <label>Email:
    <input type="email" id="email" required>
  </label>

  <label>Notes:
    <textarea id="notes"></textarea>
  </label>

  <label>Design File (optional):
    <input type="file" id="designFile" accept=".png,.jpg,.jpeg,.pdf">
  </label>

  <button type="submit" id="submitBtn">Submit Order</button>
</form>

<div id="orderResult"></div>

<!-- Firebase JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDPhLu10o_ce_1PW-_sP0MZGN8o_bMfZtk",
    authDomain: "ss-printers.firebaseapp.com",
    projectId: "ss-printers",
    storageBucket: "ss-printers.firebasestorage.app",
    messagingSenderId: "625571268370",
    appId: "1:625571268370:web:221090a300511c1ff4d5cb"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);
</script>

<!-- EmailJS -->
<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script type="text/javascript">
  (function(){
    emailjs.init("YOUR_EMAILJS_USER_ID"); // Replace with your EmailJS user ID
  })();
</script>

<!-- Custom JS -->
<script type="module">
  const orderForm = document.getElementById("orderForm");
  const resultDiv = document.getElementById("orderResult");

  orderForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    resultDiv.innerText = "";

    const clientName = document.getElementById("clientName").value.trim();
    const productType = document.getElementById("productType").value.trim();
    const quantity = parseInt(document.getElementById("quantity").value) || 0;
    const deliveryDate = document.getElementById("deliveryDate").value;
    const mobile = document.getElementById("mobile").value.trim();
    const email = document.getElementById("email").value.trim();
    const notes = document.getElementById("notes").value.trim();
    const fileInput = document.getElementById("designFile");

    if (!clientName || !productType || quantity <= 0 || !deliveryDate || !email) {
      resultDiv.innerText = "❌ Please fill all required fields correctly.";
      return;
    }

    // Upload file if exists
    let fileURL = "";
    if (fileInput && fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const storageRef = ref(storage, `orders/${Date.now()}_${file.name}`);
      try {
        const snapshot = await uploadBytes(storageRef, file);
        fileURL = await getDownloadURL(snapshot.ref);
      } catch (err) {
        console.error("File upload error:", err);
        resultDiv.innerText = "❌ Error uploading file: " + err.message;
        return;
      }
    }

    const orderData = {
      clientName,
      productType,
      quantity,
      deliveryDate,
      mobile,
      email,
      notes,
      fileURL,
      timestamp: serverTimestamp()
    };

    try {
      // Save to Firestore
      await addDoc(collection(db, "orders"), orderData);
      resultDiv.innerText = "✅ Order submitted successfully!";

      // Send Email via EmailJS
      emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", {
        client_name: clientName,
        product_type: productType,
        quantity: quantity,
        delivery_date: deliveryDate,
        email: email,
        mobile: mobile,
        notes: notes,
        file_url: fileURL
      }).then(
        function(response) {
          console.log("Email sent successfully!", response.status, response.text);
        },
        function(error) {
          console.error("Failed to send email:", error);
        }
      );

      orderForm.reset();
    } catch (error) {
      console.error("Firestore submission error:", error);
      resultDiv.innerText = "❌ Error submitting order: " + error.message;
    }
  });
</script>

</body>
</html>
